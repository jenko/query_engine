Rewrite of finquery with Ruby and Redis